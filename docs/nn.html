<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 ç¥ç»ç½‘ç»œ | ç°ä»£ç²¾ç®—ç»Ÿè®¡æ¨¡å‹</title>
  <meta name="description" content="The output format is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3 ç¥ç»ç½‘ç»œ | ç°ä»£ç²¾ç®—ç»Ÿè®¡æ¨¡å‹" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The output format is bookdown::gitbook." />
  <meta name="github-repo" content="sxpyggy/Modern-Actuarial-Models" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 ç¥ç»ç½‘ç»œ | ç°ä»£ç²¾ç®—ç»Ÿè®¡æ¨¡å‹" />
  
  <meta name="twitter:description" content="The output format is bookdown::gitbook." />
  

<meta name="author" content="Modern Actuarial Models" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="french.html"/>
<link rel="next" href="boosting.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ç°ä»£ç²¾ç®—ç»Ÿè®¡æ¨¡å‹</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>ğŸ‘¨â€ğŸ« æ¬¢è¿</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ç­”ç–‘"><i class="fa fa-check"></i>ğŸ¤” ç­”ç–‘</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#è¯¾ç¨‹å®‰æ’"><i class="fa fa-check"></i>ğŸ—“ï¸ è¯¾ç¨‹å®‰æ’</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i>ç®€ä»‹</a></li>
<li class="chapter" data-level="1" data-path="pre.html"><a href="pre.html"><i class="fa fa-check"></i><b>1</b> å‡†å¤‡å·¥ä½œ</a><ul>
<li class="chapter" data-level="1.1" data-path="pre.html"><a href="pre.html#å¸¸ç”¨é“¾æ¥"><i class="fa fa-check"></i><b>1.1</b> å¸¸ç”¨é“¾æ¥</a></li>
<li class="chapter" data-level="1.2" data-path="pre.html"><a href="pre.html#å…‹éš†ä»£ç "><i class="fa fa-check"></i><b>1.2</b> å…‹éš†ä»£ç </a></li>
<li class="chapter" data-level="1.3" data-path="pre.html"><a href="pre.html#r-interface-to-keras"><i class="fa fa-check"></i><b>1.3</b> R interface to Keras</a><ul>
<li class="chapter" data-level="1.3.1" data-path="pre.html"><a href="pre.html#rè‡ªåŠ¨å®‰è£…"><i class="fa fa-check"></i><b>1.3.1</b> Rè‡ªåŠ¨å®‰è£…</a></li>
<li class="chapter" data-level="1.3.2" data-path="pre.html"><a href="pre.html#ä½¿ç”¨reticulateå…³è”condaç¯å¢ƒ"><i class="fa fa-check"></i><b>1.3.2</b> ä½¿ç”¨reticulateå…³è”condaç¯å¢ƒ</a></li>
<li class="chapter" data-level="1.3.3" data-path="pre.html"><a href="pre.html#æŒ‡å®šcondaå®‰è£…"><i class="fa fa-check"></i><b>1.3.3</b> æŒ‡å®šcondaå®‰è£…</a></li>
<li class="chapter" data-level="1.3.4" data-path="pre.html"><a href="pre.html#ä½¿ç”¨reticulateå®‰è£…"><i class="fa fa-check"></i><b>1.3.4</b> ä½¿ç”¨reticulateå®‰è£…</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="pre.html"><a href="pre.html#r-interface-to-python"><i class="fa fa-check"></i><b>1.4</b> R interface to Python</a><ul>
<li class="chapter" data-level="1.4.1" data-path="pre.html"><a href="pre.html#reticulate-å¸¸è§å‘½ä»¤"><i class="fa fa-check"></i><b>1.4.1</b> reticulate å¸¸è§å‘½ä»¤</a></li>
<li class="chapter" data-level="1.4.2" data-path="pre.html"><a href="pre.html#åˆ‡æ¢rå…³è”çš„condaç¯å¢ƒ"><i class="fa fa-check"></i><b>1.4.2</b> åˆ‡æ¢Rå…³è”çš„condaç¯å¢ƒ</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="pre.html"><a href="pre.html#python"><i class="fa fa-check"></i><b>1.5</b> Python</a><ul>
<li class="chapter" data-level="1.5.1" data-path="pre.html"><a href="pre.html#condaç¯å¢ƒ"><i class="fa fa-check"></i><b>1.5.1</b> Condaç¯å¢ƒ</a></li>
<li class="chapter" data-level="1.5.2" data-path="pre.html"><a href="pre.html#å¸¸ç”¨çš„condaå‘½ä»¤"><i class="fa fa-check"></i><b>1.5.2</b> å¸¸ç”¨çš„Condaå‘½ä»¤</a></li>
<li class="chapter" data-level="1.5.3" data-path="pre.html"><a href="pre.html#tensorflowpytorch-gpu-version"><i class="fa fa-check"></i><b>1.5.3</b> Tensorflow/Pytorch GPU version</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="french.html"><a href="french.html"><i class="fa fa-check"></i><b>2</b> è½¦é™©ç´¢èµ”é¢‘ç‡é¢„æµ‹</a><ul>
<li class="chapter" data-level="2.1" data-path="french.html"><a href="french.html#èƒŒæ™¯ä»‹ç»"><i class="fa fa-check"></i><b>2.1</b> èƒŒæ™¯ä»‹ç»</a></li>
<li class="chapter" data-level="2.2" data-path="french.html"><a href="french.html#é¢„æµ‹æ¨¡å‹æ¦‚è¿°"><i class="fa fa-check"></i><b>2.2</b> é¢„æµ‹æ¨¡å‹æ¦‚è¿°</a></li>
<li class="chapter" data-level="2.3" data-path="french.html"><a href="french.html#ç‰¹å¾å·¥ç¨‹"><i class="fa fa-check"></i><b>2.3</b> ç‰¹å¾å·¥ç¨‹</a><ul>
<li class="chapter" data-level="2.3.1" data-path="french.html"><a href="french.html#æˆªæ–­"><i class="fa fa-check"></i><b>2.3.1</b> æˆªæ–­</a></li>
<li class="chapter" data-level="2.3.2" data-path="french.html"><a href="french.html#ç¦»æ•£åŒ–"><i class="fa fa-check"></i><b>2.3.2</b> ç¦»æ•£åŒ–</a></li>
<li class="chapter" data-level="2.3.3" data-path="french.html"><a href="french.html#è®¾å®šåŸºç¡€æ°´å¹³"><i class="fa fa-check"></i><b>2.3.3</b> è®¾å®šåŸºç¡€æ°´å¹³</a></li>
<li class="chapter" data-level="2.3.4" data-path="french.html"><a href="french.html#åå˜é‡å˜å½¢"><i class="fa fa-check"></i><b>2.3.4</b> åå˜é‡å˜å½¢</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="french.html"><a href="french.html#è®­ç»ƒé›†-éªŒè¯é›†-æµ‹è¯•é›†"><i class="fa fa-check"></i><b>2.4</b> è®­ç»ƒé›†-éªŒè¯é›†-æµ‹è¯•é›†</a></li>
<li class="chapter" data-level="2.5" data-path="french.html"><a href="french.html#æ³Šæ¾åå·®æŸå¤±å‡½æ•°"><i class="fa fa-check"></i><b>2.5</b> æ³Šæ¾åå·®æŸå¤±å‡½æ•°</a></li>
<li class="chapter" data-level="2.6" data-path="french.html"><a href="french.html#æ³Šæ¾å›å½’æ¨¡å‹"><i class="fa fa-check"></i><b>2.6</b> æ³Šæ¾å›å½’æ¨¡å‹</a></li>
<li class="chapter" data-level="2.7" data-path="french.html"><a href="french.html#æ³Šæ¾å¯åŠ æ¨¡å‹"><i class="fa fa-check"></i><b>2.7</b> æ³Šæ¾å¯åŠ æ¨¡å‹</a></li>
<li class="chapter" data-level="2.8" data-path="french.html"><a href="french.html#æ³Šæ¾å›å½’æ ‘"><i class="fa fa-check"></i><b>2.8</b> æ³Šæ¾å›å½’æ ‘</a></li>
<li class="chapter" data-level="2.9" data-path="french.html"><a href="french.html#éšæœºæ£®æ—"><i class="fa fa-check"></i><b>2.9</b> éšæœºæ£®æ—</a></li>
<li class="chapter" data-level="2.10" data-path="french.html"><a href="french.html#æ³Šæ¾æå‡æ ‘"><i class="fa fa-check"></i><b>2.10</b> æ³Šæ¾æå‡æ ‘</a></li>
<li class="chapter" data-level="2.11" data-path="french.html"><a href="french.html#æ¨¡å‹æ¯”è¾ƒ"><i class="fa fa-check"></i><b>2.11</b> æ¨¡å‹æ¯”è¾ƒ</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="nn.html"><a href="nn.html"><i class="fa fa-check"></i><b>3</b> ç¥ç»ç½‘ç»œ</a><ul>
<li class="chapter" data-level="3.1" data-path="nn.html"><a href="nn.html#å»ºç«‹ç¥ç»ç½‘ç»œçš„ä¸€èˆ¬æ­¥éª¤"><i class="fa fa-check"></i><b>3.1</b> å»ºç«‹ç¥ç»ç½‘ç»œçš„ä¸€èˆ¬æ­¥éª¤</a><ul>
<li class="chapter" data-level="3.1.1" data-path="nn.html"><a href="nn.html#æ˜ç¡®ç›®æ ‡å’Œæ•°æ®ç±»å‹"><i class="fa fa-check"></i><b>3.1.1</b> æ˜ç¡®ç›®æ ‡å’Œæ•°æ®ç±»å‹</a></li>
<li class="chapter" data-level="3.1.2" data-path="nn.html"><a href="nn.html#æ•°æ®é¢„å¤„ç†"><i class="fa fa-check"></i><b>3.1.2</b> æ•°æ®é¢„å¤„ç†</a></li>
<li class="chapter" data-level="3.1.3" data-path="nn.html"><a href="nn.html#é€‰å–åˆé€‚çš„ç¥ç»ç½‘ç»œç±»å‹"><i class="fa fa-check"></i><b>3.1.3</b> é€‰å–åˆé€‚çš„ç¥ç»ç½‘ç»œç±»å‹</a></li>
<li class="chapter" data-level="3.1.4" data-path="nn.html"><a href="nn.html#å»ºç«‹ç¥ç»ç½‘ç»œå…¨è¿æ¥ç¥ç»ç½‘ç»œ"><i class="fa fa-check"></i><b>3.1.4</b> å»ºç«‹ç¥ç»ç½‘ç»œï¼ˆå…¨è¿æ¥ç¥ç»ç½‘ç»œï¼‰</a></li>
<li class="chapter" data-level="3.1.5" data-path="nn.html"><a href="nn.html#è®­ç»ƒç¥ç»ç½‘ç»œ"><i class="fa fa-check"></i><b>3.1.5</b> è®­ç»ƒç¥ç»ç½‘ç»œ</a></li>
<li class="chapter" data-level="3.1.6" data-path="nn.html"><a href="nn.html#è°ƒå‚"><i class="fa fa-check"></i><b>3.1.6</b> è°ƒå‚</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="nn.html"><a href="nn.html#æ•°æ®é¢„å¤„ç†-1"><i class="fa fa-check"></i><b>3.2</b> æ•°æ®é¢„å¤„ç†</a></li>
<li class="chapter" data-level="3.3" data-path="nn.html"><a href="nn.html#ç¥ç»ç½‘ç»œæå‡æ¨¡å‹-combined-actuarial-neural-network"><i class="fa fa-check"></i><b>3.3</b> ç¥ç»ç½‘ç»œæå‡æ¨¡å‹ ï¼ˆcombined actuarial neural networkï¼‰</a></li>
<li class="chapter" data-level="3.4" data-path="nn.html"><a href="nn.html#ç¥ç»ç½‘ç»œç»“æ„"><i class="fa fa-check"></i><b>3.4</b> ç¥ç»ç½‘ç»œç»“æ„</a><ul>
<li class="chapter" data-level="3.4.1" data-path="nn.html"><a href="nn.html#ç»“æ„å‚æ•°"><i class="fa fa-check"></i><b>3.4.1</b> ç»“æ„å‚æ•°</a></li>
<li class="chapter" data-level="3.4.2" data-path="nn.html"><a href="nn.html#è¾“å…¥å±‚"><i class="fa fa-check"></i><b>3.4.2</b> è¾“å…¥å±‚</a></li>
<li class="chapter" data-level="3.4.3" data-path="nn.html"><a href="nn.html#embedding-layer"><i class="fa fa-check"></i><b>3.4.3</b> Embedding layer</a></li>
<li class="chapter" data-level="3.4.4" data-path="nn.html"><a href="nn.html#éšè—å±‚"><i class="fa fa-check"></i><b>3.4.4</b> éšè—å±‚</a></li>
<li class="chapter" data-level="3.4.5" data-path="nn.html"><a href="nn.html#è¾“å‡ºå±‚"><i class="fa fa-check"></i><b>3.4.5</b> è¾“å‡ºå±‚</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="nn.html"><a href="nn.html#è®­ç»ƒç¥ç»ç½‘ç»œ-1"><i class="fa fa-check"></i><b>3.5</b> è®­ç»ƒç¥ç»ç½‘ç»œ</a></li>
<li class="chapter" data-level="3.6" data-path="nn.html"><a href="nn.html#æ€»ç»“"><i class="fa fa-check"></i><b>3.6</b> æ€»ç»“</a></li>
<li class="chapter" data-level="3.7" data-path="nn.html"><a href="nn.html#å…¶å®ƒæ¨¡å‹"><i class="fa fa-check"></i><b>3.7</b> å…¶å®ƒæ¨¡å‹</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="boosting.html"><a href="boosting.html"><i class="fa fa-check"></i><b>4</b> æå‡æ–¹æ³• (Boosting)</a><ul>
<li class="chapter" data-level="4.1" data-path="boosting.html"><a href="boosting.html#adaboost-01"><i class="fa fa-check"></i><b>4.1</b> AdaBoost (0,1)</a></li>
<li class="chapter" data-level="4.2" data-path="boosting.html"><a href="boosting.html#logit-boost-real-discrete-gentle-adaboost"><i class="fa fa-check"></i><b>4.2</b> Logit Boost (real, discrete, gentle AdaBoost)</a></li>
<li class="chapter" data-level="4.3" data-path="boosting.html"><a href="boosting.html#adaboost.m1"><i class="fa fa-check"></i><b>4.3</b> AdaBoost.M1</a></li>
<li class="chapter" data-level="4.4" data-path="boosting.html"><a href="boosting.html#samme-stage-wise-additive-modeling-using-a-multi-class-exponential-loss-function"><i class="fa fa-check"></i><b>4.4</b> SAMME (Stage-wise Additive Modeling using a Multi-class Exponential loss function)</a></li>
<li class="chapter" data-level="4.5" data-path="boosting.html"><a href="boosting.html#samme.r-multi-class-real-adaboost"><i class="fa fa-check"></i><b>4.5</b> SAMME.R (multi-class real AdaBoost)</a></li>
<li class="chapter" data-level="4.6" data-path="boosting.html"><a href="boosting.html#gradient-boosting"><i class="fa fa-check"></i><b>4.6</b> Gradient Boosting</a></li>
<li class="chapter" data-level="4.7" data-path="boosting.html"><a href="boosting.html#newton-boosting"><i class="fa fa-check"></i><b>4.7</b> Newton Boosting</a></li>
<li class="chapter" data-level="4.8" data-path="boosting.html"><a href="boosting.html#xgboost"><i class="fa fa-check"></i><b>4.8</b> XGBoost</a></li>
<li class="chapter" data-level="4.9" data-path="boosting.html"><a href="boosting.html#gradient-boost"><i class="fa fa-check"></i><b>4.9</b> Gradient Boost</a></li>
<li class="chapter" data-level="4.10" data-path="boosting.html"><a href="boosting.html#xgboost-1"><i class="fa fa-check"></i><b>4.10</b> XGBoost</a></li>
<li class="chapter" data-level="4.11" data-path="boosting.html"><a href="boosting.html#case-study"><i class="fa fa-check"></i><b>4.11</b> Case study</a><ul>
<li class="chapter" data-level="4.11.1" data-path="boosting.html"><a href="boosting.html#commonly-used-python-code-for-py-beginners"><i class="fa fa-check"></i><b>4.11.1</b> Commonly used Python code (for py-beginners)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/sxpyggy/Modern-Actuarial-Models/tree/modern-actuarial-models" target="blank">GitHub ä»“åº“</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ç°ä»£ç²¾ç®—ç»Ÿè®¡æ¨¡å‹</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="nn" class="section level1">
<h1><span class="header-section-number">3</span> ç¥ç»ç½‘ç»œ</h1>
<p>æ­£å¦‚è®¡ç®—æœºé€Ÿåº¦çš„æå‡å’ŒMCMCæ–¹æ³•ç»™è´å¶æ–¯ç»Ÿè®¡å¸¦æ¥äº†ç”Ÿæœºï¼Œè®¡ç®—æœºè¿ç®—èƒ½åŠ›çš„æå‡å’Œåå‘ä¼ æ’­ç®—æ³•ï¼ˆback propagationï¼‰ä¹Ÿç»™ç¥ç»ç½‘ç»œå¸¦æ¥äº†é£é€Ÿå‘å±•ã€‚</p>
<p><code>Tensorflow</code>å’Œ<code>Pytorch</code>çš„æ›´æ–°é€Ÿåº¦åæ˜ äº†è¿™ä¸ªé¢†åŸŸçš„çƒ­åº¦ã€‚</p>
<div id="å»ºç«‹ç¥ç»ç½‘ç»œçš„ä¸€èˆ¬æ­¥éª¤" class="section level2">
<h2><span class="header-section-number">3.1</span> å»ºç«‹ç¥ç»ç½‘ç»œçš„ä¸€èˆ¬æ­¥éª¤</h2>
<div id="æ˜ç¡®ç›®æ ‡å’Œæ•°æ®ç±»å‹" class="section level3">
<h3><span class="header-section-number">3.1.1</span> æ˜ç¡®ç›®æ ‡å’Œæ•°æ®ç±»å‹</h3>
<ul>
<li><p>ç¥ç»ç½‘ç»œæ˜¯ä¸€ç§éå‚éçº¿æ€§å›å½’æ¨¡å‹ï¼Œå®ƒå¯ä»¥åˆ»ç”»éçº¿æ€§æ•ˆåº”å’Œäº¤äº’æ•ˆåº”ã€‚</p></li>
<li><p>åœ¨ä½¿ç”¨ç¥ç»ç½‘ç»œå‰ï¼Œéœ€è¦ç†è§£ç ”ç©¶ç›®æ ‡å’Œæ•°æ®ç»“æ„ï¼Œæœ‰ä¸€äº›ç‰¹æ®Šçš„layerï¼Œå¦‚å·ç§¯å±‚ï¼Œä¸“é—¨ä¸ºæŸç§ä»»åŠ¡ã€æˆ–æŸç§æ•°æ®ç»“æ„è€Œè®¾ç«‹ï¼Œä¸æ˜¯å¯ä»¥ç”¨åœ¨ä»»ä½•çš„æ•°æ®ä¸Šã€‚</p></li>
<li><p>ç¥ç»ç½‘ç»œæœ‰å¤§é‡çš„å‚æ•°ï¼Œå…¨å±€æœ€ä¼˜è§£å¿…ç„¶ä¼šé€ æˆè¿‡æ‹Ÿåˆï¼Œé€šå¸¸åˆ©ç”¨éªŒè¯é›†æŸå¤±æ¥åˆ¤æ–­æ¢¯åº¦ä¸‹é™çš„æ¬¡æ•°ã€‚</p></li>
</ul>
</div>
<div id="æ•°æ®é¢„å¤„ç†" class="section level3">
<h3><span class="header-section-number">3.1.2</span> æ•°æ®é¢„å¤„ç†</h3>
<ul>
<li><p>æè¿°æ€§ç»Ÿè®¡åˆ†æ</p></li>
<li><p>ç¼ºå¤±å€¼ã€å¼‚å¸¸å€¼å¤„ç†</p></li>
<li><p>è¿ç»­å‹å˜é‡æ ‡å‡†åŒ–ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®©æ¢¯åº¦ä¸‹é™æ³•æ›´æœ‰æ•ˆåœ°å·¥ä½œã€‚å¸¸ç”¨çš„æ ‡å‡†åŒ–æ–¹æ³•æœ‰<em>MinMaxScaler</em></p>
<p><span class="math display">\[x^*=2\frac{x-\min x}{\max x - \min x}-1\]</span></p></li>
<li><p>åˆ†ç±»å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨dummy codingã€one-hot encodingï¼Œæˆ–è€…ä½¿ç”¨ç¥ç»ç½‘ç»œä¸­çš„embedding layerã€‚ç¬¬ä¸‰ç§åŠæ³•å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘å‚æ•°ä¸ªæ•°ã€‚</p></li>
<li><p>è®­ç»ƒ-éªŒè¯-æµ‹è¯•æ•°æ®åˆ†å‰²ï¼šè®­ç»ƒé›†ç”¨äºæ¢¯åº¦ä¸‹é™æ³•æ±‚è§£å‚æ•°ï¼ŒéªŒè¯é›†ç”¨äºåˆ¤æ–­epochæ¬¡æ•°ã€è°ƒæ•´æ¨¡å‹ç»“æ„çš„è¶…å‚æ•°ï¼Œæµ‹è¯•é›†ç”¨äºæ¯”è¾ƒä¸åŒæ¨¡å‹çš„æ ·æœ¬å¤–é¢„æµ‹èƒ½åŠ›ã€‚</p></li>
</ul>
</div>
<div id="é€‰å–åˆé€‚çš„ç¥ç»ç½‘ç»œç±»å‹" class="section level3">
<h3><span class="header-section-number">3.1.3</span> é€‰å–åˆé€‚çš„ç¥ç»ç½‘ç»œç±»å‹</h3>
<ul>
<li><p>å…¨è¿æ¥ç¥ç»ç½‘ç»œï¼šé€‚ç”¨äºä¸€èˆ¬çš„å›å½’é—®é¢˜ï¼Œå¦‚ç´¢èµ”é¢‘ç‡é¢„æµ‹ã€‚ä¿¡æ¯ä¸€ç›´å‘å‰ä¼ é€’ã€‚å‚æ•°ä¸ªæ•°è¾ƒå¤šã€‚å¯è§£é‡Šæ€§å·®ã€‚</p></li>
<li><p>å·ç§¯ç¥ç»ç½‘ç»œï¼šé€‚ç”¨äºæ•°æ®æœ‰ç©ºé—´ç»“æ„ï¼Œä¸”ç›¸åŒçš„æ¨¡å¼å¯èƒ½å‡ºç°åœ¨ä¸åŒçš„ä½ç½®ï¼Œå¦‚å›¾åƒè¯†åˆ«ã€‚ä¿¡æ¯ä¸€ç›´å‘å‰ä¼ é€’ã€‚å‚æ•°ä¸ªæ•°è¾ƒå°‘ã€‚æœ‰å¯è§£é‡Šæ€§ã€‚</p></li>
<li><p>é€’å½’ç¥ç»ç½‘ç»œï¼šé€‚ç”¨äºæ•°æ®æœ‰æ—¶é—´åºåˆ—ç‰¹å¾ï¼Œä¸”ç›¸åŒçš„æ¨¡å¼å¯èƒ½å‡ºç°åœ¨ä¸åŒæ—¶é—´ç‚¹ï¼Œå¦‚å¤©æ°”é¢„æŠ¥ã€è¯­éŸ³è¯†åˆ«ã€‚ä¿¡æ¯å¯ä»¥è¿”å›åˆ°å‰é¢çš„ç¥ç»å…ƒã€‚å‚æ•°ä¸ªæ•°è¾ƒå¤šã€‚å¯è§£é‡Šæ€§å·®ã€‚</p></li>
</ul>
</div>
<div id="å»ºç«‹ç¥ç»ç½‘ç»œå…¨è¿æ¥ç¥ç»ç½‘ç»œ" class="section level3">
<h3><span class="header-section-number">3.1.4</span> å»ºç«‹ç¥ç»ç½‘ç»œï¼ˆå…¨è¿æ¥ç¥ç»ç½‘ç»œï¼‰</h3>
<p>åœ¨å»ºç«‹ç¥ç»ç½‘ç»œæ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li><p>è¾“å…¥å±‚æ•°æ®ç±»å‹</p></li>
<li><p>éšè—å±‚å±‚æ•°ï¼Œéšè—å±‚æ€§è´¨ï¼Œç¥ç»å…ƒä¸ªæ•°ï¼Œæ¿€æ´»å‡½æ•°ï¼Œæ­£åˆ™åŒ–ï¼Œdropout</p></li>
<li><p>è¾“å‡ºç¥ç»å…ƒæ•°æ®ç±»å‹ï¼Œè¾“å‡ºç¥ç»å…ƒæ¿€æ´»å‡½æ•°</p></li>
<li><p>æŸå¤±å‡½æ•°é€‰æ‹©</p></li>
</ul>
</div>
<div id="è®­ç»ƒç¥ç»ç½‘ç»œ" class="section level3">
<h3><span class="header-section-number">3.1.5</span> è®­ç»ƒç¥ç»ç½‘ç»œ</h3>
<p>åœ¨è®­ç»ƒç¥ç»ç½‘ç»œæ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹</p>
<ul>
<li><p>æ¢¯åº¦ä¸‹é™æ³•ï¼ˆoptimizerï¼‰</p></li>
<li><p>è¿­ä»£æ¬¡æ•°ï¼ˆpatienceï¼‰</p></li>
<li><p>éå†æ¬¡æ•°ï¼ˆepochï¼‰ï¼Œæ‰¹é‡å¤§å°ï¼ˆbatch sizeï¼‰</p></li>
</ul>
</div>
<div id="è°ƒå‚" class="section level3">
<h3><span class="header-section-number">3.1.6</span> è°ƒå‚</h3>
<p>è¿”å›ç¬¬4æ­¥ï¼Œè°ƒæ•´æ¨¡å‹ç»“æ„çš„è¶…å‚æ•°ï¼ˆhyper-parameter tuningï¼‰ï¼Œè§‚å¯ŸéªŒè¯æŸå¤±çš„å˜åŒ–ï¼Œé€‰å–æœ€ç»ˆæ¨¡å‹ã€‚</p>
</div>
</div>
<div id="æ•°æ®é¢„å¤„ç†-1" class="section level2">
<h2><span class="header-section-number">3.2</span> æ•°æ®é¢„å¤„ç†</h2>
<pre><code>  &#39;data.frame&#39;: 678013 obs. of  12 variables:
   $ IDpol     : num  1 3 5 10 11 13 15 17 18 21 ...
   $ ClaimNb   : &#39;table&#39; num [1:678013(1d)] 1 1 1 1 1 1 1 1 1 1 ...
   $ Exposure  : num  0.1 0.77 0.75 0.09 0.84 0.52 0.45 0.27 0.71 0.15 ...
   $ VehPower  : int  5 5 6 7 7 6 6 7 7 7 ...
   $ VehAge    : int  0 0 2 0 0 2 2 0 0 0 ...
   $ DrivAge   : int  55 55 52 46 46 38 38 33 33 41 ...
   $ BonusMalus: int  50 50 50 50 50 50 50 68 68 50 ...
   $ VehBrand  : Factor w/ 11 levels &quot;B1&quot;,&quot;B10&quot;,&quot;B11&quot;,..: 4 4 4 4 4 4 4 4 4 4 ...
   $ VehGas    : chr  &quot;Regular&quot; &quot;Regular&quot; &quot;Diesel&quot; &quot;Diesel&quot; ...
   $ Area      : Factor w/ 6 levels &quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,..: 4 4 2 2 2 5 5 3 3 2 ...
   $ Density   : int  1217 1217 54 76 76 3003 3003 137 137 60 ...
   $ Region    : Factor w/ 21 levels &quot;Alsace&quot;,&quot;Aquitaine&quot;,..: 21 21 18 2 2 16 16 13 13 17 ...</code></pre>
<p>åœ¨è¿›è¡Œä¸‹é¢codeä¹‹å‰ï¼Œéœ€è¦è¿è¡Œä¸Šä¸€ç« çš„ä»£ç ç›´åˆ°Treeä¹‹å‰ã€‚</p>
<ul>
<li>è¿ç»­å‹å˜é‡ï¼šæ ‡å‡†åŒ–å¤„ç†ã€‚</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="nn.html#cb24-1"></a>PreProcess.Continuous &lt;-<span class="st"> </span><span class="cf">function</span>(var1, dat1){</span>
<span id="cb24-2"><a href="nn.html#cb24-2"></a>   <span class="kw">names</span>(dat1)[<span class="kw">names</span>(dat1) <span class="op">==</span><span class="st"> </span>var1]  &lt;-<span class="st"> &quot;V1&quot;</span></span>
<span id="cb24-3"><a href="nn.html#cb24-3"></a>   dat1<span class="op">$</span>X &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(dat1<span class="op">$</span>V1)</span>
<span id="cb24-4"><a href="nn.html#cb24-4"></a>   dat1<span class="op">$</span>X &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>(dat1<span class="op">$</span>X<span class="op">-</span><span class="kw">min</span>(dat1<span class="op">$</span>X))<span class="op">/</span>(<span class="kw">max</span>(dat1<span class="op">$</span>X)<span class="op">-</span><span class="kw">min</span>(dat1<span class="op">$</span>X))<span class="op">-</span><span class="dv">1</span></span>
<span id="cb24-5"><a href="nn.html#cb24-5"></a>   <span class="kw">names</span>(dat1)[<span class="kw">names</span>(dat1) <span class="op">==</span><span class="st"> &quot;V1&quot;</span>]  &lt;-<span class="st"> </span>var1</span>
<span id="cb24-6"><a href="nn.html#cb24-6"></a>   <span class="kw">names</span>(dat1)[<span class="kw">names</span>(dat1) <span class="op">==</span><span class="st"> &quot;X&quot;</span>]  &lt;-<span class="st"> </span><span class="kw">paste</span>(var1,<span class="st">&quot;X&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb24-7"><a href="nn.html#cb24-7"></a>   dat1</span>
<span id="cb24-8"><a href="nn.html#cb24-8"></a>   }</span>
<span id="cb24-9"><a href="nn.html#cb24-9"></a></span>
<span id="cb24-10"><a href="nn.html#cb24-10"></a>Features.PreProcess &lt;-<span class="st"> </span><span class="cf">function</span>(dat1){</span>
<span id="cb24-11"><a href="nn.html#cb24-11"></a>   dat1<span class="op">$</span>VehPower &lt;-<span class="st"> </span><span class="kw">pmin</span>(dat1<span class="op">$</span>VehPower,<span class="dv">9</span>)</span>
<span id="cb24-12"><a href="nn.html#cb24-12"></a>   dat1 &lt;-<span class="st"> </span><span class="kw">PreProcess.Continuous</span>(<span class="st">&quot;VehPower&quot;</span>, dat1)   </span>
<span id="cb24-13"><a href="nn.html#cb24-13"></a>   dat1<span class="op">$</span>VehAge &lt;-<span class="st"> </span><span class="kw">pmin</span>(dat1<span class="op">$</span>VehAge,<span class="dv">20</span>)</span>
<span id="cb24-14"><a href="nn.html#cb24-14"></a>   dat1 &lt;-<span class="st"> </span><span class="kw">PreProcess.Continuous</span>(<span class="st">&quot;VehAge&quot;</span>, dat1)   </span>
<span id="cb24-15"><a href="nn.html#cb24-15"></a>   dat1<span class="op">$</span>DrivAge &lt;-<span class="st"> </span><span class="kw">pmin</span>(dat1<span class="op">$</span>DrivAge,<span class="dv">90</span>)</span>
<span id="cb24-16"><a href="nn.html#cb24-16"></a>   dat1 &lt;-<span class="st"> </span><span class="kw">PreProcess.Continuous</span>(<span class="st">&quot;DrivAge&quot;</span>, dat1)   </span>
<span id="cb24-17"><a href="nn.html#cb24-17"></a>   dat1<span class="op">$</span>BonusMalus &lt;-<span class="st"> </span><span class="kw">pmin</span>(dat1<span class="op">$</span>BonusMalus,<span class="dv">150</span>)</span>
<span id="cb24-18"><a href="nn.html#cb24-18"></a>   dat1 &lt;-<span class="st"> </span><span class="kw">PreProcess.Continuous</span>(<span class="st">&quot;BonusMalus&quot;</span>, dat1)   </span>
<span id="cb24-19"><a href="nn.html#cb24-19"></a>   dat1<span class="op">$</span>VehBrandX &lt;-<span class="st"> </span><span class="kw">as.integer</span>(dat1<span class="op">$</span>VehBrand)<span class="op">-</span><span class="dv">1</span>  <span class="co"># categorical variable</span></span>
<span id="cb24-20"><a href="nn.html#cb24-20"></a>   dat1<span class="op">$</span>VehGas &lt;-<span class="st"> </span><span class="kw">as.factor</span>(dat1<span class="op">$</span>VehGas)</span>
<span id="cb24-21"><a href="nn.html#cb24-21"></a>   dat1<span class="op">$</span>VehGasX &lt;-<span class="st"> </span><span class="kw">as.integer</span>(dat1<span class="op">$</span>VehGas) <span class="op">-</span><span class="st"> </span><span class="fl">1.5</span> <span class="co"># binary: continuous or categorical</span></span>
<span id="cb24-22"><a href="nn.html#cb24-22"></a>   dat1 &lt;-<span class="st"> </span><span class="kw">PreProcess.Continuous</span>(<span class="st">&quot;Area&quot;</span>, dat1)   </span>
<span id="cb24-23"><a href="nn.html#cb24-23"></a>   dat1 &lt;-<span class="st"> </span><span class="kw">PreProcess.Continuous</span>(<span class="st">&quot;Density&quot;</span>, dat1)   </span>
<span id="cb24-24"><a href="nn.html#cb24-24"></a>   dat1<span class="op">$</span>RegionX &lt;-<span class="st"> </span><span class="kw">as.integer</span>(dat1<span class="op">$</span>Region) <span class="op">-</span><span class="st"> </span><span class="dv">1</span> <span class="co"># categorical</span></span>
<span id="cb24-25"><a href="nn.html#cb24-25"></a>   dat1</span>
<span id="cb24-26"><a href="nn.html#cb24-26"></a>}</span>
<span id="cb24-27"><a href="nn.html#cb24-27"></a></span>
<span id="cb24-28"><a href="nn.html#cb24-28"></a>dat2 &lt;-<span class="st"> </span><span class="kw">Features.PreProcess</span>(freMTPL2freq)   </span>
<span id="cb24-29"><a href="nn.html#cb24-29"></a><span class="kw">names</span>(dat2)</span>
<span id="cb24-30"><a href="nn.html#cb24-30"></a>dat2_train&lt;-dat2[index_train,]</span>
<span id="cb24-31"><a href="nn.html#cb24-31"></a>dat2_valid&lt;-dat2[index_valid,]</span>
<span id="cb24-32"><a href="nn.html#cb24-32"></a>dat2_test&lt;-dat2[index_test,]</span>
<span id="cb24-33"><a href="nn.html#cb24-33"></a>dat2_learn&lt;-dat2[index_learn,]</span></code></pre></div>
<ul>
<li><p>åˆ†ç±»å˜é‡ï¼š é‡‡ç”¨embedding layerã€‚</p></li>
<li><p>è®­ç»ƒé›†-éªŒè¯é›†-æµ‹è¯•é›†ï¼šåˆ†å±‚æŠ½æ ·ã€‚</p></li>
<li><p>è°ƒæ•´æ•°æ®ç»“æ„ï¼Œä½¿å…¶åŒ¹é…ç¥ç»ç½‘ç»œçš„è¾“å…¥å±‚åŠå…¶ç»´åº¦ã€‚è¾“å…¥æ•°æ®é›†åŒ…æ‹¬<code>Xtrain, Brtain, Retrain, Vtrain</code>ï¼Œå› å˜é‡æ•°æ®é›†ä¸º<code>Ytrain</code>ã€‚</p></li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="nn.html#cb25-1"></a>lambda.hom &lt;-<span class="st"> </span><span class="kw">sum</span>(dat2_train<span class="op">$</span>ClaimNb)<span class="op">/</span><span class="kw">sum</span>(dat2_train<span class="op">$</span>Exposure);lambda.hom</span>
<span id="cb25-2"><a href="nn.html#cb25-2"></a><span class="kw">names</span>(dat2)</span>
<span id="cb25-3"><a href="nn.html#cb25-3"></a></span>
<span id="cb25-4"><a href="nn.html#cb25-4"></a><span class="co"># index of continous variables (non-categorical)</span></span>
<span id="cb25-5"><a href="nn.html#cb25-5"></a></span>
<span id="cb25-6"><a href="nn.html#cb25-6"></a>features &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">13</span><span class="op">:</span><span class="dv">16</span>, <span class="dv">18</span><span class="op">:</span><span class="dv">20</span>)</span>
<span id="cb25-7"><a href="nn.html#cb25-7"></a><span class="kw">names</span>(dat2_learn)[features]</span>
<span id="cb25-8"><a href="nn.html#cb25-8"></a>(q0 &lt;-<span class="st"> </span><span class="kw">length</span>(features))</span>
<span id="cb25-9"><a href="nn.html#cb25-9"></a></span>
<span id="cb25-10"><a href="nn.html#cb25-10"></a><span class="co"># training data</span></span>
<span id="cb25-11"><a href="nn.html#cb25-11"></a></span>
<span id="cb25-12"><a href="nn.html#cb25-12"></a>Xtrain&lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_train[, features])  <span class="co"># design matrix learning sample</span></span>
<span id="cb25-13"><a href="nn.html#cb25-13"></a>Brtrain &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_train<span class="op">$</span>VehBrandX)</span>
<span id="cb25-14"><a href="nn.html#cb25-14"></a>Retrain &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_train<span class="op">$</span>RegionX)</span>
<span id="cb25-15"><a href="nn.html#cb25-15"></a>Ytrain&lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_train<span class="op">$</span>ClaimNb)</span>
<span id="cb25-16"><a href="nn.html#cb25-16"></a>Vtrain&lt;-<span class="kw">as.matrix</span>(<span class="kw">log</span>(dat2_train<span class="op">$</span>Exposure<span class="op">*</span>lambda.hom))</span>
<span id="cb25-17"><a href="nn.html#cb25-17"></a></span>
<span id="cb25-18"><a href="nn.html#cb25-18"></a><span class="co"># validation data </span></span>
<span id="cb25-19"><a href="nn.html#cb25-19"></a></span>
<span id="cb25-20"><a href="nn.html#cb25-20"></a>Xvalid&lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_valid[, features])  <span class="co"># design matrix learning sample</span></span>
<span id="cb25-21"><a href="nn.html#cb25-21"></a>Brvalid &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_valid<span class="op">$</span>VehBrandX)</span>
<span id="cb25-22"><a href="nn.html#cb25-22"></a>Revalid &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_valid<span class="op">$</span>RegionX)</span>
<span id="cb25-23"><a href="nn.html#cb25-23"></a>Yvalid&lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_valid<span class="op">$</span>ClaimNb)</span>
<span id="cb25-24"><a href="nn.html#cb25-24"></a>Vvalid&lt;-<span class="kw">as.matrix</span>(<span class="kw">log</span>(dat2_valid<span class="op">$</span>Exposure<span class="op">*</span>lambda.hom))</span>
<span id="cb25-25"><a href="nn.html#cb25-25"></a>xxvalid&lt;-<span class="kw">list</span>(Xvalid,Brvalid,Revalid,Vvalid)</span>
<span id="cb25-26"><a href="nn.html#cb25-26"></a></span>
<span id="cb25-27"><a href="nn.html#cb25-27"></a><span class="co"># testing data</span></span>
<span id="cb25-28"><a href="nn.html#cb25-28"></a></span>
<span id="cb25-29"><a href="nn.html#cb25-29"></a>Xtest &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_test[, features])    <span class="co"># design matrix test sample</span></span>
<span id="cb25-30"><a href="nn.html#cb25-30"></a>Brtest &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_test<span class="op">$</span>VehBrandX)</span>
<span id="cb25-31"><a href="nn.html#cb25-31"></a>Retest &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_test<span class="op">$</span>RegionX)</span>
<span id="cb25-32"><a href="nn.html#cb25-32"></a>Ytest &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dat2_test<span class="op">$</span>ClaimNb)</span>
<span id="cb25-33"><a href="nn.html#cb25-33"></a>Vtest &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">log</span>(dat2_test<span class="op">$</span>Exposure<span class="op">*</span>lambda.hom))</span></code></pre></div>
</div>
<div id="ç¥ç»ç½‘ç»œæå‡æ¨¡å‹-combined-actuarial-neural-network" class="section level2">
<h2><span class="header-section-number">3.3</span> ç¥ç»ç½‘ç»œæå‡æ¨¡å‹ ï¼ˆcombined actuarial neural networkï¼‰</h2>
<p>åŸºæœ¬ç»“æ„</p>
<p><span class="math display">\[\ln \lambda(\mathbf{x})= e\hat{\lambda}^{\text{GAM}}(\mathbf{x})\hat{\lambda}^{\text{NN}}(\mathbf{x})\]</span></p>
<p>å…¶ä¸­ï¼Œ<span class="math inline">\(\hat{\lambda}^{\text{GAM}}\)</span>ä¸ºå¹¿ä¹‰å¯åŠ è¾¹ç¼˜æå‡æ¨¡å‹çš„ç´¢èµ”é¢‘ç‡ä¼°è®¡å€¼ï¼ˆå‚è§ä¸Šä¸€ç« ï¼‰ï¼Œ<span class="math inline">\(\hat{\lambda}^{\text{NN}}\)</span>ä¸ºç¥ç»ç½‘ç»œç´¢èµ”é¢‘ç‡çš„ä¼°è®¡å€¼ï¼Œç¬¬ä¸€é¡¹åœ¨æ¨¡å‹è®­ç»ƒä¸­ä¿æŒä¸å˜ã€‚</p>
<p>ä½¿ç”¨ä¸Šè¿°æ¨¡å‹çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p><span class="math inline">\(\hat{\lambda}^{\text{GAM}}\)</span>çš„éƒ¨åˆ†å¯è§£é‡Šæ€§ã€‚</p></li>
<li><p>ç¥ç»ç½‘ç»œä»ä¸€ä¸ªç›¸å¯¹â€œè¾ƒå¥½â€çš„åˆå§‹çŠ¶æ€<span class="math inline">\(e\hat{\lambda}^{\text{GAM}}(\mathbf{x})\)</span>å¼€å§‹è®­ç»ƒï¼Œå¾ˆå¿«æ”¶æ•›ã€‚</p></li>
</ul>
<p>åœ¨ä»£ç å®ç°ä¸­ï¼Œå¯ä»¥æŠŠ<span class="math inline">\(e\hat{\lambda}^{\text{GAM}}\)</span>å½“ä½œä¼ªé£é™©æš´éœ²æ•°ã€‚</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="nn.html#cb26-1"></a>CANN &lt;-<span class="st"> </span><span class="dv">1</span>  <span class="co"># 0 = normal NN, 1=CANN</span></span>
<span id="cb26-2"><a href="nn.html#cb26-2"></a><span class="cf">if</span> (CANN<span class="op">==</span><span class="dv">1</span>){</span>
<span id="cb26-3"><a href="nn.html#cb26-3"></a>     Vtrain &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">log</span>(dat1_train<span class="op">$</span>fitGAM1))</span>
<span id="cb26-4"><a href="nn.html#cb26-4"></a>     Vvalid&lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">log</span>(dat1_valid<span class="op">$</span>fitGAM1))</span>
<span id="cb26-5"><a href="nn.html#cb26-5"></a>     Vtest &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">log</span>(dat1_test<span class="op">$</span>fitGAM1))</span>
<span id="cb26-6"><a href="nn.html#cb26-6"></a>}</span></code></pre></div>
</div>
<div id="ç¥ç»ç½‘ç»œç»“æ„" class="section level2">
<h2><span class="header-section-number">3.4</span> ç¥ç»ç½‘ç»œç»“æ„</h2>
<p><img src="plots/1/nn-structure.png" width="60%" style="display: block; margin: auto;" /></p>
<p>åœ¨æ„å»ºç¥ç»ç½‘ç»œæ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<div id="ç»“æ„å‚æ•°" class="section level3">
<h3><span class="header-section-number">3.4.1</span> ç»“æ„å‚æ•°</h3>
<ol style="list-style-type: decimal">
<li>ç¥ç»ç½‘ç»œç»“æ„çš„è¶…å‚æ•°é€‰æ‹©ï¼Œ<code>BrLabel</code>ä¸ºè½¦å‹ä¸ªæ•°ï¼Œ<code>ReLabel</code>ä¸ºåœ°åŒºä¸ªæ•°ï¼Œ<code>q1-q4</code>ä¸ºå››ä¸ªéšè—å±‚ä¸­ç¥ç»å…ƒä¸ªæ•°ï¼Œ<code>d</code>ä¸ºembedding layerä¸­ç¥ç»å…ƒä¸ªæ•°ã€‚</li>
</ol>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="nn.html#cb27-1"></a><span class="co"># hyperparameters of the neural network architecture</span></span>
<span id="cb27-2"><a href="nn.html#cb27-2"></a></span>
<span id="cb27-3"><a href="nn.html#cb27-3"></a>(BrLabel &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(dat2_train<span class="op">$</span>VehBrandX)))</span>
<span id="cb27-4"><a href="nn.html#cb27-4"></a>(ReLabel &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(dat2_train<span class="op">$</span>RegionX)))</span>
<span id="cb27-5"><a href="nn.html#cb27-5"></a>q1 &lt;-<span class="st"> </span><span class="dv">20</span>   </span>
<span id="cb27-6"><a href="nn.html#cb27-6"></a>q2 &lt;-<span class="st"> </span><span class="dv">15</span></span>
<span id="cb27-7"><a href="nn.html#cb27-7"></a>q3 &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb27-8"><a href="nn.html#cb27-8"></a>q4 &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb27-9"><a href="nn.html#cb27-9"></a>d &lt;-<span class="st"> </span><span class="dv">1</span>        <span class="co"># dimensions embedding layers for categorical features</span></span></code></pre></div>
</div>
<div id="è¾“å…¥å±‚" class="section level3">
<h3><span class="header-section-number">3.4.2</span> è¾“å…¥å±‚</h3>
<ol start="2" style="list-style-type: decimal">
<li><p>è¾“å…¥å±‚åŒ…æ‹¬<code>Design, VehBrand, Region, LogVol</code>ï¼Œå…¶ä¸­<code>Design</code>ä¸ºè¿ç»­å‹åå˜é‡çš„è¾“å…¥å±‚ï¼Œ<code>VehBrand, Region</code>ä¸ºåˆ†ç±»å˜é‡çš„è¾“å…¥å±‚ï¼Œ<code>LogVol</code>ç›´æ¥è¿æ¥åˆ°æ¨¡å‹è¾“å‡ºç¥ç»å…ƒã€‚</p></li>
<li><p><code>shape</code>è¡¨ç¤ºè¾“å…¥ï¼ˆè¾“å‡ºï¼‰ç»´åº¦ï¼ˆç¥ç»å…ƒä¸ªæ•°ï¼‰,<code>dtype</code>è¡¨ç¤ºæ•°æ®ç±»å‹ï¼Œ<code>name</code>è¡¨ç¤ºå±‚åã€‚</p></li>
<li><p><code>shape=(None, 7)</code> ä¸­<code>None</code>è¡¨ç¤ºæ ·æœ¬å¤§å°ï¼Œå› ä¸ºè¿˜æ²¡æœ‰æ•°æ®è¿›å…¥ç¥ç»ç½‘ç»œï¼Œæ•…æ­¤æ—¶ä¸ç¡®å®šã€‚</p>
<p>Tensor(â€œDesign_1:0â€, shape=(None, 7), dtype=float32)</p></li>
</ol>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="nn.html#cb28-1"></a><span class="co"># input layer</span></span>
<span id="cb28-2"><a href="nn.html#cb28-2"></a></span>
<span id="cb28-3"><a href="nn.html#cb28-3"></a>(Design   &lt;-<span class="st"> </span><span class="kw">layer_input</span>(<span class="dt">shape =</span> <span class="kw">c</span>(q0),  <span class="dt">dtype =</span> <span class="st">&#39;float32&#39;</span>, <span class="dt">name =</span> <span class="st">&#39;Design&#39;</span>))</span>
<span id="cb28-4"><a href="nn.html#cb28-4"></a>(VehBrand &lt;-<span class="st"> </span><span class="kw">layer_input</span>(<span class="dt">shape =</span> <span class="kw">c</span>(<span class="dv">1</span>),   <span class="dt">dtype =</span> <span class="st">&#39;int32&#39;</span>, <span class="dt">name =</span> <span class="st">&#39;VehBrand&#39;</span>))</span>
<span id="cb28-5"><a href="nn.html#cb28-5"></a>(Region   &lt;-<span class="st"> </span><span class="kw">layer_input</span>(<span class="dt">shape =</span> <span class="kw">c</span>(<span class="dv">1</span>),   <span class="dt">dtype =</span> <span class="st">&#39;int32&#39;</span>, <span class="dt">name =</span> <span class="st">&#39;Region&#39;</span>))</span>
<span id="cb28-6"><a href="nn.html#cb28-6"></a>(LogVol   &lt;-<span class="st"> </span><span class="kw">layer_input</span>(<span class="dt">shape =</span> <span class="kw">c</span>(<span class="dv">1</span>),   <span class="dt">dtype =</span> <span class="st">&#39;float32&#39;</span>, <span class="dt">name =</span> <span class="st">&#39;LogVol&#39;</span>))</span></code></pre></div>
</div>
<div id="embedding-layer" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Embedding layer</h3>
<ol start="5" style="list-style-type: decimal">
<li><p>å»ºç«‹ä¸€ä¸ªlayerï¼Œéœ€è¦æ˜ç¡®è¾“å…¥ç¥ç»å…ƒä¸ªæ•°<code>input_dim</code>å’Œè¾“å‡ºç¥ç»å…ƒä¸ªæ•°<code>output_dim</code>ï¼Œé€šå¸¸éœ€è¦æŒ‡å®šè¾“å‡ºç¥ç»å…ƒä¸ªæ•°ï¼Œè€Œè¾“å…¥ç¥ç»å…ƒä¸ªæ•°ç”±å®ƒçš„ä¸Šå±‚è¾“å‡ºç¥ç»å…ƒä¸ªæ•°å†³å®šã€‚</p></li>
<li><p>æŠŠåˆ†ç±»å˜é‡ç”¨<code>layer_embedding</code>å¤„ç†ï¼Œè¿™ä¸¤ä¸ª<code>layer_embedding</code>çš„è¾“å‡ºç¥ç»å…ƒä¸ªæ•°ä¸º<span class="math inline">\(d\)</span>ï¼Œå³æ¯ä¸ªæ°´å¹³é€šè¿‡<code>layer_embedding</code>è¾“å‡º<span class="math inline">\(d\)</span>ä¸ªè¿ç»­å‹å˜é‡ï¼Œå½“<span class="math inline">\(d=1\)</span>ï¼Œ<code>layer_embedding</code>ç±»ä¼¼äºGLMå¯¹åˆ†ç±»å˜é‡çš„å¤„ç†ã€‚<code>input_length</code>ä¸»è¦ç”¨äºæ—¶é—´åºåˆ—æ•°æ®ï¼Œå¦‚æ¯ä¸ªæ ·æœ¬ä¸ºå¤šä¸ªè¯ç»„æˆçš„ä¸€å¥è¯ï¼Œè¿™é‡Œä¸€ä¸ªæ ·æœ¬åªæœ‰ä¸€ä¸ªæ°´å¹³ï¼Œæ•…<code>input_length = 1</code>ã€‚</p></li>
<li><p><code>layer_flatten</code>ç”¨äºè°ƒæ•´ç»´åº¦ï¼Œ<code>layer_flatten</code>çš„è¾“å…¥ç»´åº¦æ˜¯<span class="math inline">\(n\times 1\times d\)</span>ï¼Œè¾“å‡ºç»´åº¦æ˜¯<span class="math inline">\(n\times d\)</span>ï¼Œè¯¥å±‚æ²¡æœ‰å‚æ•°ã€‚è¯¥è¾“å‡ºç»´åº¦æ˜¯<code>layer_dense</code>è¦æ±‚çš„è¾“å…¥ç»´åº¦ã€‚å»ºç«‹ç¥ç»ç½‘ç»œéœ€è¦æ³¨æ„å±‚é—´ç»´åº¦åŒ¹é…ã€‚</p></li>
<li><p><code>BrandEmb</code>å»ºç«‹çš„æ˜ å°„ä¸º<span class="math inline">\(\{1,\ldots,11\}\rightarrow 1\times\mathbf{R}^d\rightarrow\mathbf{R}^d\)</span>. <code>RegionEmb</code>å»ºç«‹çš„æ˜ å°„ä¸º<span class="math inline">\(\{1,\ldots,21\}\rightarrow 1\times\mathbf{R}^d\rightarrow\mathbf{R}^d\)</span></p></li>
</ol>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="nn.html#cb29-1"></a><span class="co"># embedding layer</span></span>
<span id="cb29-2"><a href="nn.html#cb29-2"></a></span>
<span id="cb29-3"><a href="nn.html#cb29-3"></a>(<span class="dt">BrandEmb =</span> VehBrand <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-4"><a href="nn.html#cb29-4"></a><span class="st">    </span><span class="kw">layer_embedding</span>(<span class="dt">input_dim =</span> BrLabel, <span class="dt">output_dim =</span> d, </span>
<span id="cb29-5"><a href="nn.html#cb29-5"></a>                    <span class="dt">input_length =</span> <span class="dv">1</span>, <span class="dt">name =</span> <span class="st">&#39;BrandEmb&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb29-6"><a href="nn.html#cb29-6"></a><span class="st">   </span><span class="kw">layer_flatten</span>(<span class="dt">name=</span><span class="st">&#39;Brand_flat&#39;</span>))</span>
<span id="cb29-7"><a href="nn.html#cb29-7"></a><span class="co"># input_dim is the size of vocabulary; input_length is the length of input sequences</span></span>
<span id="cb29-8"><a href="nn.html#cb29-8"></a>    </span>
<span id="cb29-9"><a href="nn.html#cb29-9"></a>(<span class="dt">RegionEmb =</span> Region <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-10"><a href="nn.html#cb29-10"></a><span class="st">      </span><span class="kw">layer_embedding</span>(<span class="dt">input_dim =</span> ReLabel, <span class="dt">output_dim =</span> d, </span>
<span id="cb29-11"><a href="nn.html#cb29-11"></a>                      <span class="dt">input_length =</span> <span class="dv">1</span>, <span class="dt">name =</span> <span class="st">&#39;RegionEmb&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb29-12"><a href="nn.html#cb29-12"></a><span class="st">      </span><span class="kw">layer_flatten</span>(<span class="dt">name=</span><span class="st">&#39;Region_flat&#39;</span>))</span></code></pre></div>
</div>
<div id="éšè—å±‚" class="section level3">
<h3><span class="header-section-number">3.4.4</span> éšè—å±‚</h3>
<p>9 <code>Network</code>å»ºç«‹çš„æ˜ å°„ä¸º<span class="math display">\[[-1,1]^{q0}\times\mathbf{R}^d\times\mathbf{R}^d\rightarrow (-1,1)^{q1}\rightarrow (-1,1)^{q2}\\ \rightarrow (-1,1)^{q3}\rightarrow (-1,1)^{q4}\rightarrow\mathbf{R}\]</span></p>
<ol start="10" style="list-style-type: decimal">
<li><p><code>layer_concatenate</code>æŠŠä¸‰ä¸ªè¾“å…¥å±‚è¿èµ·æ¥ï¼Œ<code>layer_dropout</code>ä¸ºé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œ<code>layer_batch_normalization</code>ä¸ºé˜²æ­¢vanishing gradient problemï¼Œè¿™ä¸‰ç§å±‚å†…æ— å‚æ•°ï¼Œä¸”ä¸ä¼šæ”¹å˜ä¸Šå±‚çš„ç»´åº¦ã€‚<code>layer_dropout</code>ä»¤ä¸€å®šæ¯”ä¾‹çš„ä¸Šå±‚ç¥ç»å…ƒä¸º0ï¼Œæ­£åˆ™åŒ–æ–¹æ³•è¿˜åŒ…æ‹¬åœ¨<code>layer_dense</code>ä¸­ä½¿ç”¨<span class="math inline">\(L^2\)</span>èŒƒæ•°æ­£åˆ™åŒ–<code>kernel_regularizer = regularizer_l2</code>ã€‚<code>layer_batch_normalization</code>æŠŠè¾“å‡ºç¥ç»å…ƒæ˜ å°„åˆ°<span class="math inline">\((-1,1)\)</span>ï¼Œé€šå¸¸åœ¨æ¿€æ´»å‡½æ•°ä¸º<code>relu</code>æ›´æœ‰ç”¨ã€‚</p></li>
<li><p>å¸¸ç”¨çš„æ¿€æ´»å‡½æ•°ä¸º<code>tanh, relu, linear, exponential, softmax, sigmoid</code>ã€‚å…¶ä¸­ï¼Œ<code>sigmoid, softmax</code>é€‚ç”¨äºäºŒåˆ†ç±»å’Œå¤šåˆ†ç±»çš„è¾“å‡ºç¥ç»å…ƒï¼Œ<code>exponential</code>é€‚ç”¨äºå› å˜é‡ä¸ºæ­£ï¼Œå¦‚æ­¤æ—¶çš„ç´¢èµ”é¢‘ç‡é¢„æµ‹ã€‚æ­¤å¤–<code>sigmoid</code>å’Œ<code>tanh</code>æœ‰çº¿æ€§å…³ç³»ï¼Œå¯ä»¥åªè€ƒè™‘å…¶ä¸­ä¸€ä¸ªã€‚</p></li>
<li><p><code>layer_dense</code>çš„æ˜ å°„ä¸º<code>output = activation (dot (input, kernal) + bias)</code>ï¼Œæ‰€ä»¥æ¯ä¸ªè¾“å‡ºç¥ç»å…ƒéƒ½å«æœ‰è¾“å…¥ç¥ç»å…ƒçš„ä¿¡æ¯ã€‚å¦‚æœè€ƒè™‘å¤šä¸ªå…¨è¿æ¥å±‚ï¼Œå¯ä»¥åˆ»ç”»åå˜é‡çš„äº¤äº’æ•ˆåº”ç°ã€‚æ¿€æ´»å‡½æ•°å¦‚æœå–éçº¿æ€§å‡½æ•°ï¼Œåˆ™å¯ä»¥åˆ»ç”»åå˜é‡çš„éçº¿æ€§æ•ˆåº”ã€‚</p></li>
<li><p><code>Network</code>ä¸­æœ€åä¸€å±‚çš„å‚æ•°è®¾å®šä¸º0ï¼Œä½¿å¾—<code>Network</code>åˆå§‹å€¼ä¸º0ï¼Œè¿™æ ·ç¥ç»ç½‘ç»œåˆå§‹çŠ¶æ€ä¸ºGAMï¼Œæ¢¯åº¦ä¸‹é™å°†ä»GAMå¼€å§‹ã€‚</p></li>
</ol>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="nn.html#cb30-1"></a>Network =<span class="st"> </span><span class="kw">list</span>(Design, BrandEmb, RegionEmb) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">layer_concatenate</span>(<span class="dt">name=</span><span class="st">&#39;concate&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-2"><a href="nn.html#cb30-2"></a><span class="st">          </span><span class="kw">layer_dense</span>(<span class="dt">units=</span>q1, <span class="dt">activation=</span><span class="st">&#39;tanh&#39;</span>, <span class="dt">name=</span><span class="st">&#39;hidden1&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-3"><a href="nn.html#cb30-3"></a><span class="st">          </span><span class="kw">layer_batch_normalization</span>()<span class="op">%&gt;%</span></span>
<span id="cb30-4"><a href="nn.html#cb30-4"></a><span class="st">          </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span><span class="fl">0.05</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-5"><a href="nn.html#cb30-5"></a><span class="st">          </span><span class="kw">layer_dense</span>(<span class="dt">units=</span>q2, <span class="dt">activation=</span><span class="st">&#39;tanh&#39;</span>, <span class="dt">name=</span><span class="st">&#39;hidden2&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-6"><a href="nn.html#cb30-6"></a><span class="st">          </span><span class="kw">layer_batch_normalization</span>()<span class="op">%&gt;%</span></span>
<span id="cb30-7"><a href="nn.html#cb30-7"></a><span class="st">          </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span><span class="fl">0.05</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-8"><a href="nn.html#cb30-8"></a><span class="st">          </span><span class="kw">layer_dense</span>(<span class="dt">units=</span>q3, <span class="dt">activation=</span><span class="st">&#39;tanh&#39;</span>, <span class="dt">name=</span><span class="st">&#39;hidden3&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-9"><a href="nn.html#cb30-9"></a><span class="st">          </span><span class="kw">layer_batch_normalization</span>()<span class="op">%&gt;%</span></span>
<span id="cb30-10"><a href="nn.html#cb30-10"></a><span class="st">          </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span><span class="fl">0.05</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-11"><a href="nn.html#cb30-11"></a><span class="st">          </span><span class="kw">layer_dense</span>(<span class="dt">units=</span>q4, <span class="dt">activation=</span><span class="st">&#39;tanh&#39;</span>, <span class="dt">name=</span><span class="st">&#39;hidden4&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-12"><a href="nn.html#cb30-12"></a><span class="st">          </span><span class="kw">layer_batch_normalization</span>()<span class="op">%&gt;%</span></span>
<span id="cb30-13"><a href="nn.html#cb30-13"></a><span class="st">          </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span><span class="fl">0.05</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-14"><a href="nn.html#cb30-14"></a><span class="st">          </span><span class="kw">layer_dense</span>(<span class="dt">units=</span><span class="dv">1</span>, <span class="dt">activation=</span><span class="st">&#39;linear&#39;</span>, <span class="dt">name=</span><span class="st">&#39;Network&#39;</span>,</span>
<span id="cb30-15"><a href="nn.html#cb30-15"></a>                      <span class="dt">weights =</span> <span class="kw">list</span>(<span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim=</span><span class="kw">c</span>(q4,<span class="dv">1</span>)), <span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim=</span><span class="kw">c</span>(<span class="dv">1</span>))))</span></code></pre></div>
</div>
<div id="è¾“å‡ºå±‚" class="section level3">
<h3><span class="header-section-number">3.4.5</span> è¾“å‡ºå±‚</h3>
<ol start="14" style="list-style-type: decimal">
<li><p><code>Response</code>å»ºç«‹çš„æ˜ å°„ä¸º<span class="math inline">\(\mathbf{R}\times \mathbf{R}\rightarrow \mathbf{R}^+\)</span>ï¼Œä¸”è¦æ±‚è¯¥æ˜ å°„ä¸­çš„å‚æ•°ä¸å‚åŠ æ¢¯åº¦ä¸‹é™æ³•ã€‚å¯ä»¥çœ‹åˆ°<code>Network</code>çš„è¾“å‡ºç¥ç»å…ƒä¸º<span class="math inline">\(\ln \hat{\lambda}^{\text{NN}}(\mathbf{x})\)</span>ï¼Œè¾“å…¥å±‚<code>LogVol</code>ä¸º<span class="math inline">\(\ln e\hat{\lambda}^{\text{GAM}}(\mathbf{x})\)</span>ï¼Œ<code>Response</code>çš„è¾“å‡ºç¥ç»å…ƒä¸º<span class="math display">\[\exp\left(\ln \hat{\lambda}^{\text{NN}}(\mathbf{x}) + \ln e\hat{\lambda}^{\text{GAM}}(\mathbf{x})\right)=e\hat{\lambda}^{\text{GAM}}(\mathbf{x})\hat{\lambda}^{\text{NN}}(\mathbf{x}).\]</span></p></li>
<li><p>é€šè¿‡æ¢¯åº¦ä¸‹é™æ³•ä½¿å¾—è¾“å‡ºç¥ç»å…ƒ<span class="math inline">\(e\hat{\lambda}^{\text{GAM}}(\mathbf{x})\hat{\lambda}^{\text{NN}}(\mathbf{x})\)</span>ä¸è§‚å¯Ÿå€¼<span class="math inline">\(N\)</span>æœ€æ¥è¿‘ï¼ˆç”¨æ³Šæ¾åå·®æŸå¤±åº¦é‡ï¼‰ï¼Œè¿›è€Œè®­ç»ƒç¥ç»ç½‘ç»œ<span class="math inline">\(\hat{\lambda}^{\text{NN}}(\mathbf{x})\)</span>ä¸­çš„å‚æ•°ã€‚</p></li>
<li><p>Keraså®šä¹‰å¹³å‡æ³Šæ¾åå·®æŸå¤±ä¸º</p></li>
</ol>
<p><span class="math display">\[\tilde{\mathcal{L}}(\mathbf{N},\mathbf{\hat{N}})=\frac{1}{|\mathbf{N}|}\sum_{i}\left[\hat{N}_i-N_i\ln\left(\hat{N}_i\right)\right]\]</span></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="nn.html#cb31-1"></a>Response =<span class="st"> </span><span class="kw">list</span>(Network, LogVol) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">layer_add</span>(<span class="dt">name=</span><span class="st">&#39;Add&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-2"><a href="nn.html#cb31-2"></a><span class="st">           </span><span class="kw">layer_dense</span>(<span class="dt">units=</span><span class="dv">1</span>, <span class="dt">activation=</span>k_exp, <span class="dt">name =</span> <span class="st">&#39;Response&#39;</span>, <span class="dt">trainable=</span><span class="ot">FALSE</span>,</span>
<span id="cb31-3"><a href="nn.html#cb31-3"></a>                        <span class="dt">weights=</span><span class="kw">list</span>(<span class="kw">array</span>(<span class="dv">1</span>, <span class="dt">dim=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)), <span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim=</span><span class="kw">c</span>(<span class="dv">1</span>))))</span>
<span id="cb31-4"><a href="nn.html#cb31-4"></a></span>
<span id="cb31-5"><a href="nn.html#cb31-5"></a>model &lt;-<span class="st"> </span><span class="kw">keras_model</span>(<span class="dt">inputs =</span> <span class="kw">c</span>(Design, VehBrand, Region, LogVol), <span class="dt">outputs =</span> <span class="kw">c</span>(Response))</span>
<span id="cb31-6"><a href="nn.html#cb31-6"></a>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">compile</span>(<span class="dt">optimizer =</span> <span class="kw">optimizer_nadam</span>(), <span class="dt">loss =</span> <span class="st">&#39;poisson&#39;</span>)</span>
<span id="cb31-7"><a href="nn.html#cb31-7"></a><span class="kw">summary</span>(model)</span></code></pre></div>
<ol start="17" style="list-style-type: decimal">
<li>ä¸‹è¡¨åˆ—å‡ºäº†ç¥ç»ç½‘ç»œçš„ç»“æ„ï¼ŒåŒ…æ‹¬å±‚çš„åç§°ã€(å±‚çš„ç‰¹æ€§)ã€è¾“å‡ºç¥ç»å…ƒä¸ªæ•°ã€å‚æ•°ä¸ªæ•°ã€ä¸Šå±‚çš„åç§°ã€‚</li>
</ol>
<pre><code>Model: &quot;model&quot;
________________________________________________________________________________________________________________________________
Layer (type)                              Output Shape                Param #        Connected to                               
================================================================================================================================
VehBrand (InputLayer)                     [(None, 1)]                 0                                                         
________________________________________________________________________________________________________________________________
Region (InputLayer)                       [(None, 1)]                 0                                                         
________________________________________________________________________________________________________________________________
BrandEmb (Embedding)                      (None, 1, 1)                11             VehBrand[0][0]                             
________________________________________________________________________________________________________________________________
RegionEmb (Embedding)                     (None, 1, 1)                21             Region[0][0]                               
________________________________________________________________________________________________________________________________
Design (InputLayer)                       [(None, 7)]                 0                                                         
________________________________________________________________________________________________________________________________
Brand_flat (Flatten)                      (None, 1)                   0              BrandEmb[0][0]                             
________________________________________________________________________________________________________________________________
Region_flat (Flatten)                     (None, 1)                   0              RegionEmb[0][0]                            
________________________________________________________________________________________________________________________________
concate (Concatenate)                     (None, 9)                   0              Design[0][0]                               
                                                                                     Brand_flat[0][0]                           
                                                                                     Region_flat[0][0]                          
________________________________________________________________________________________________________________________________
hidden1 (Dense)                           (None, 20)                  200            concate[0][0]                              
________________________________________________________________________________________________________________________________
batch_normalization_1 (BatchNormalization (None, 20)                  80             hidden1[0][0]                              
________________________________________________________________________________________________________________________________
dropout (Dropout)                         (None, 20)                  0              batch_normalization_1[0][0]                
________________________________________________________________________________________________________________________________
hidden2 (Dense)                           (None, 15)                  315            dropout[0][0]                              
________________________________________________________________________________________________________________________________
batch_normalization_2 (BatchNormalization (None, 15)                  60             hidden2[0][0]                              
________________________________________________________________________________________________________________________________
dropout_1 (Dropout)                       (None, 15)                  0              batch_normalization_2[0][0]                
________________________________________________________________________________________________________________________________
hidden3 (Dense)                           (None, 10)                  160            dropout_1[0][0]                            
________________________________________________________________________________________________________________________________
batch_normalization_3 (BatchNormalization (None, 10)                  40             hidden3[0][0]                              
________________________________________________________________________________________________________________________________
dropout_2 (Dropout)                       (None, 10)                  0              batch_normalization_3[0][0]                
________________________________________________________________________________________________________________________________
hidden4 (Dense)                           (None, 5)                   55             dropout_2[0][0]                            
________________________________________________________________________________________________________________________________
batch_normalization_4 (BatchNormalization (None, 5)                   20             hidden4[0][0]                              
________________________________________________________________________________________________________________________________
dropout_3 (Dropout)                       (None, 5)                   0              batch_normalization_4[0][0]                
________________________________________________________________________________________________________________________________
Network (Dense)                           (None, 1)                   6              dropout_3[0][0]                            
________________________________________________________________________________________________________________________________
LogVol (InputLayer)                       [(None, 1)]                 0                                                         
________________________________________________________________________________________________________________________________
Add (Add)                                 (None, 1)                   0              Network[0][0]                              
                                                                                     LogVol[0][0]                               
________________________________________________________________________________________________________________________________
Response (Dense)                          (None, 1)                   2              Add[0][0]                                  
================================================================================================================================
Total params: 970
Trainable params: 868
Non-trainable params: 102
________________________________________________________________________________________________________________________________</code></pre>
</div>
</div>
<div id="è®­ç»ƒç¥ç»ç½‘ç»œ-1" class="section level2">
<h2><span class="header-section-number">3.5</span> è®­ç»ƒç¥ç»ç½‘ç»œ</h2>
<p>è®­ç»ƒç¥ç»ç½‘ç»œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol style="list-style-type: decimal">
<li><p>åˆå§‹åŒ–ç¥ç»ç½‘ç»œï¼Œå°†ä»GAMå¼€å§‹è®­ç»ƒç¥ç»ç½‘ç»œï¼Œä¸”GAMé¢„æµ‹éƒ¨åˆ†ä¿æŒä¸å˜ã€‚</p></li>
<li><p>å½“<code>batch_size</code>ä¸ºå…¨ä½“è®­ç»ƒé›†æ—¶ï¼Œä¸º<em>steepest gradient decent method</em>ï¼Œå‚æ•°åœ¨ä¸€ä¸ª<code>epoch</code>åªè¿­ä»£ä¸€æ¬¡ã€‚</p></li>
<li><p>å½“<code>batch_size</code>æ¯”å…¨ä½“è®­ç»ƒé›†å°æ—¶ï¼Œä¸º<em>stochastic gradient decent method</em>ï¼Œå‚æ•°åœ¨ä¸€ä¸ª<code>epoch</code>è¿­ä»£æ¬¡æ•°çº¦ä¸º<code>training size / batch size</code>ã€‚</p></li>
<li><p>æ¢¯åº¦ä¸‹é™æ³•å¸¸å¼•å…¥<em>momentum</em>ï¼Œè¿›è€Œæå‡ä¼˜åŒ–æ•ˆç‡ï¼Œå¦‚<code>adam, nadam,rmsprop</code>ç­‰ï¼Œè¿™äº›ç®—æ³•è‡ªåŠ¨é€‰æ‹©<code>learning rate, momentum parameters</code>ç­‰ã€‚</p></li>
<li><p><code>callback_early_stopping (monitor = "val_loss", patience =10)</code>è¡¨ç¤ºå¦‚æœéªŒè¯é›†æŸå¤±åœ¨10æ¬¡å†…æ²¡æœ‰æå‡ï¼Œé‚£ä¹ˆåœæ­¢è®­ç»ƒï¼Œç”±æ­¤å¯ä»¥æ§åˆ¶è¿­ä»£æ¬¡æ•°ã€‚</p></li>
<li><p>ä½¿ç”¨<code>predict</code>åœ¨æµ‹è¯•é›†ä¸Šé¢„æµ‹ã€‚</p></li>
</ol>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="nn.html#cb33-1"></a><span class="co"># fitting the neural network</span></span>
<span id="cb33-2"><a href="nn.html#cb33-2"></a>early_stop &lt;-<span class="st"> </span><span class="kw">callback_early_stopping</span>(<span class="dt">monitor =</span> <span class="st">&quot;val_loss&quot;</span>, <span class="dt">patience =</span><span class="dv">10</span>)</span>
<span id="cb33-3"><a href="nn.html#cb33-3"></a><span class="co"># print_dot_callback &lt;- callback_lambda(</span></span>
<span id="cb33-4"><a href="nn.html#cb33-4"></a><span class="co">#   on_epoch_end = function(epoch, logs) {</span></span>
<span id="cb33-5"><a href="nn.html#cb33-5"></a><span class="co">#     if (epoch %% 50 == 0) cat(&quot;\n&quot;)</span></span>
<span id="cb33-6"><a href="nn.html#cb33-6"></a><span class="co">#     cat(&quot;.&quot;)</span></span>
<span id="cb33-7"><a href="nn.html#cb33-7"></a><span class="co">#   }</span></span>
<span id="cb33-8"><a href="nn.html#cb33-8"></a><span class="co"># )  </span></span>
<span id="cb33-9"><a href="nn.html#cb33-9"></a>{t1 &lt;-<span class="st"> </span><span class="kw">proc.time</span>();</span>
<span id="cb33-10"><a href="nn.html#cb33-10"></a>fit &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fit</span>(<span class="kw">list</span>(Xtrain, Brtrain, Retrain, Vtrain), Ytrain,</span>
<span id="cb33-11"><a href="nn.html#cb33-11"></a>                     <span class="dt">epochs=</span><span class="dv">500</span>, <span class="dt">batch_size=</span><span class="dv">5000</span>, <span class="dt">verbose=</span><span class="dv">1</span>,</span>
<span id="cb33-12"><a href="nn.html#cb33-12"></a>                     <span class="dt">validation_data=</span><span class="kw">list</span>(xxvalid,Yvalid),</span>
<span id="cb33-13"><a href="nn.html#cb33-13"></a>                     <span class="dt">callbacks=</span><span class="kw">list</span>(early_stop));</span>
<span id="cb33-14"><a href="nn.html#cb33-14"></a>(<span class="kw">proc.time</span>()<span class="op">-</span>t1)}</span>
<span id="cb33-15"><a href="nn.html#cb33-15"></a></span>
<span id="cb33-16"><a href="nn.html#cb33-16"></a><span class="co"># png(&quot;./plots/1/nn.png&quot;)</span></span>
<span id="cb33-17"><a href="nn.html#cb33-17"></a><span class="kw">matplot</span>(<span class="kw">cbind</span>(fit<span class="op">$</span>metrics<span class="op">$</span>loss,fit<span class="op">$</span>metrics<span class="op">$</span>val_loss), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;epoch&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Keras Poisson Loss&quot;</span>)</span>
<span id="cb33-18"><a href="nn.html#cb33-18"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;training loss&quot;</span>,<span class="st">&quot;validation loss&quot;</span>),<span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dt">col=</span><span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</span>
<span id="cb33-19"><a href="nn.html#cb33-19"></a><span class="co"># dev.off()</span></span>
<span id="cb33-20"><a href="nn.html#cb33-20"></a></span>
<span id="cb33-21"><a href="nn.html#cb33-21"></a><span class="co"># calculating the predictions</span></span>
<span id="cb33-22"><a href="nn.html#cb33-22"></a>dat2_test<span class="op">$</span>fitNN &lt;-<span class="st"> </span><span class="kw">as.vector</span>(model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">predict</span>(<span class="kw">list</span>(Xtest, Brtest, Retest, Vtest)))</span>
<span id="cb33-23"><a href="nn.html#cb33-23"></a><span class="kw">keras_poisson_dev</span>(dat2_test<span class="op">$</span>fitNN, dat2_test<span class="op">$</span>ClaimNb)</span>
<span id="cb33-24"><a href="nn.html#cb33-24"></a><span class="kw">Poisson.Deviance</span>(dat2_test<span class="op">$</span>fitNN, dat2_test<span class="op">$</span>ClaimNb)</span></code></pre></div>
<p><img src="plots/1/nn.png" width="60%"  style="display: block; margin: auto;" /></p>
</div>
<div id="æ€»ç»“" class="section level2">
<h2><span class="header-section-number">3.6</span> æ€»ç»“</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="nn.html#cb34-1"></a>dev_sum&lt;-<span class="kw">fread</span>(<span class="st">&quot;./plots/1/dev_sum.csv&quot;</span>)[,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb34-2"><a href="nn.html#cb34-2"></a>AD&lt;-<span class="kw">data.frame</span>(<span class="dt">model=</span><span class="st">&quot;Neural network&quot;</span>,<span class="dt">test_error=</span><span class="dv">0</span>,<span class="dt">test_error_keras=</span><span class="dv">0</span>)</span>
<span id="cb34-3"><a href="nn.html#cb34-3"></a>dev_sum&lt;-<span class="kw">rbind</span>(dev_sum,AD)</span>
<span id="cb34-4"><a href="nn.html#cb34-4"></a>dev_sum<span class="op">$</span>test_error[<span class="dv">8</span>]&lt;-<span class="kw">round</span>(<span class="kw">Poisson.Deviance</span>(dat2_test<span class="op">$</span>fitNN, dat2_test<span class="op">$</span>ClaimNb),<span class="dv">4</span>)</span>
<span id="cb34-5"><a href="nn.html#cb34-5"></a>dev_sum<span class="op">$</span>test_error_keras[<span class="dv">8</span>]&lt;-<span class="kw">round</span>(<span class="kw">keras_poisson_dev</span>(dat2_test<span class="op">$</span>fitNN, dat2_test<span class="op">$</span>ClaimNb),<span class="dv">4</span>)</span>
<span id="cb34-6"><a href="nn.html#cb34-6"></a><span class="co"># write.csv(dev_sum,&quot;./plots/1/dev_sum.csv&quot;)</span></span></code></pre></div>
<p><img src="03-nn_files/figure-html/sum%20output-1.png" width="672"  /></p>
<ul>
<li><p>Boosting &gt; RF &gt; Tree &gt; NN &gt; GAM &gt; GLM &gt; Homo</p></li>
<li><p>Boosting, RF, Tree, NNç›¸è¾ƒäºGAMçš„æå‡ä¸»è¦åœ¨äºäº¤äº’ä½œç”¨ï¼›GAMç›¸è¾ƒäºGLMçš„æå‡ä¸å¤§ï¼ŒåŸå› æ˜¯åœ¨GLMä¸­è¿›è¡Œäº†åˆé€‚çš„ç‰¹å¾å·¥ç¨‹ï¼Œå¯ä»¥åˆ»ç”»éçº¿æ€§æ•ˆåº”ã€‚</p></li>
</ul>
</div>
<div id="å…¶å®ƒæ¨¡å‹" class="section level2">
<h2><span class="header-section-number">3.7</span> å…¶å®ƒæ¨¡å‹</h2>
<p>é€šè¿‡å°è¯•å‘ç°ï¼Œä¸»è¦å­˜åœ¨ä¸¤ä¸ªäº¤äº’ä½œç”¨ï¼š<code>VehPower, VehAge, VehGas, VehBrand</code>å’Œ<code>DriAge, BonusMalus</code>ï¼Œå¯è®¾ç«‹å¦‚ä¸‹ç®€åŒ–çš„ç¥ç»ç½‘ç»œæå‡æ¨¡å‹ã€‚</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="nn.html#cb35-1"></a>train.x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">as.matrix</span>(dat2_train[,<span class="kw">c</span>(<span class="st">&quot;VehPowerX&quot;</span>, <span class="st">&quot;VehAgeX&quot;</span>, <span class="st">&quot;VehGasX&quot;</span>)]),</span>
<span id="cb35-2"><a href="nn.html#cb35-2"></a>                <span class="kw">as.matrix</span>(dat2_train[,<span class="st">&quot;VehBrandX&quot;</span>]),</span>
<span id="cb35-3"><a href="nn.html#cb35-3"></a>                <span class="kw">as.matrix</span>(dat2_train[,<span class="kw">c</span>(<span class="st">&quot;DrivAgeX&quot;</span>, <span class="st">&quot;BonusMalus&quot;</span>)]),</span>
<span id="cb35-4"><a href="nn.html#cb35-4"></a>                <span class="kw">as.matrix</span>(<span class="kw">log</span>(dat1_train<span class="op">$</span>fitGAM1)) )</span>
<span id="cb35-5"><a href="nn.html#cb35-5"></a>valid.x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">as.matrix</span>(dat2_valid[,<span class="kw">c</span>(<span class="st">&quot;VehPowerX&quot;</span>, <span class="st">&quot;VehAgeX&quot;</span>, <span class="st">&quot;VehGasX&quot;</span>)]),</span>
<span id="cb35-6"><a href="nn.html#cb35-6"></a>                <span class="kw">as.matrix</span>(dat2_valid[,<span class="st">&quot;VehBrandX&quot;</span>]),</span>
<span id="cb35-7"><a href="nn.html#cb35-7"></a>                <span class="kw">as.matrix</span>(dat2_valid[,<span class="kw">c</span>(<span class="st">&quot;DrivAgeX&quot;</span>, <span class="st">&quot;BonusMalus&quot;</span>)]),</span>
<span id="cb35-8"><a href="nn.html#cb35-8"></a>                <span class="kw">as.matrix</span>(<span class="kw">log</span>(dat1_valid<span class="op">$</span>fitGAM1)) )</span>
<span id="cb35-9"><a href="nn.html#cb35-9"></a>test.x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">as.matrix</span>(dat2_test[,<span class="kw">c</span>(<span class="st">&quot;VehPowerX&quot;</span>, <span class="st">&quot;VehAgeX&quot;</span>, <span class="st">&quot;VehGasX&quot;</span>)]),</span>
<span id="cb35-10"><a href="nn.html#cb35-10"></a>                <span class="kw">as.matrix</span>(dat2_test[,<span class="st">&quot;VehBrandX&quot;</span>]),</span>
<span id="cb35-11"><a href="nn.html#cb35-11"></a>                <span class="kw">as.matrix</span>(dat2_test[,<span class="kw">c</span>(<span class="st">&quot;DrivAgeX&quot;</span>, <span class="st">&quot;BonusMalus&quot;</span>)]),</span>
<span id="cb35-12"><a href="nn.html#cb35-12"></a>                <span class="kw">as.matrix</span>(<span class="kw">log</span>(dat1_test<span class="op">$</span>fitGAM1)) )</span>
<span id="cb35-13"><a href="nn.html#cb35-13"></a></span>
<span id="cb35-14"><a href="nn.html#cb35-14"></a>neurons &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>,<span class="dv">10</span>,<span class="dv">5</span>)</span>
<span id="cb35-15"><a href="nn.html#cb35-15"></a></span>
<span id="cb35-16"><a href="nn.html#cb35-16"></a>model<span class="fl">.2</span>IA &lt;-<span class="st"> </span><span class="cf">function</span>(Brlabel){</span>
<span id="cb35-17"><a href="nn.html#cb35-17"></a>   Cont1        &lt;-<span class="st"> </span><span class="kw">layer_input</span>(<span class="dt">shape =</span> <span class="kw">c</span>(<span class="dv">3</span>), <span class="dt">dtype =</span> <span class="st">&#39;float32&#39;</span>, <span class="dt">name=</span><span class="st">&#39;Cont1&#39;</span>)</span>
<span id="cb35-18"><a href="nn.html#cb35-18"></a>   Cat1         &lt;-<span class="st"> </span><span class="kw">layer_input</span>(<span class="dt">shape =</span> <span class="kw">c</span>(<span class="dv">1</span>), <span class="dt">dtype =</span> <span class="st">&#39;int32&#39;</span>,   <span class="dt">name=</span><span class="st">&#39;Cat1&#39;</span>)</span>
<span id="cb35-19"><a href="nn.html#cb35-19"></a>   Cont2        &lt;-<span class="st"> </span><span class="kw">layer_input</span>(<span class="dt">shape =</span> <span class="kw">c</span>(<span class="dv">2</span>), <span class="dt">dtype =</span> <span class="st">&#39;float32&#39;</span>, <span class="dt">name=</span><span class="st">&#39;Cont2&#39;</span>)</span>
<span id="cb35-20"><a href="nn.html#cb35-20"></a>   LogExposure  &lt;-<span class="st"> </span><span class="kw">layer_input</span>(<span class="dt">shape =</span> <span class="kw">c</span>(<span class="dv">1</span>), <span class="dt">dtype =</span> <span class="st">&#39;float32&#39;</span>, <span class="dt">name =</span> <span class="st">&#39;LogExposure&#39;</span>) </span>
<span id="cb35-21"><a href="nn.html#cb35-21"></a>   </span>
<span id="cb35-22"><a href="nn.html#cb35-22"></a>   x.input &lt;-<span class="st"> </span><span class="kw">c</span>(Cont1, Cat1, Cont2, LogExposure)</span>
<span id="cb35-23"><a href="nn.html#cb35-23"></a>   <span class="co">#</span></span>
<span id="cb35-24"><a href="nn.html#cb35-24"></a>   Cat1_embed =<span class="st"> </span>Cat1 <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb35-25"><a href="nn.html#cb35-25"></a><span class="st">            </span><span class="kw">layer_embedding</span>(<span class="dt">input_dim =</span> Brlabel, <span class="dt">output_dim =</span> <span class="dv">1</span>, <span class="dt">trainable=</span><span class="ot">TRUE</span>, </span>
<span id="cb35-26"><a href="nn.html#cb35-26"></a>                    <span class="dt">input_length =</span> <span class="dv">1</span>, <span class="dt">name =</span> <span class="st">&#39;Cat1_embed&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb35-27"><a href="nn.html#cb35-27"></a><span class="st">                    </span><span class="kw">layer_flatten</span>(<span class="dt">name=</span><span class="st">&#39;Cat1_flat&#39;</span>)</span>
<span id="cb35-28"><a href="nn.html#cb35-28"></a>   <span class="co">#</span></span>
<span id="cb35-29"><a href="nn.html#cb35-29"></a>   NNetwork1 =<span class="st"> </span><span class="kw">list</span>(Cont1, Cat1_embed) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">layer_concatenate</span>(<span class="dt">name=</span><span class="st">&#39;cont&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb35-30"><a href="nn.html#cb35-30"></a><span class="st">            </span><span class="kw">layer_dense</span>(<span class="dt">units=</span>neurons[<span class="dv">1</span>], <span class="dt">activation=</span><span class="st">&#39;relu&#39;</span>, <span class="dt">name=</span><span class="st">&#39;hidden1&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb35-31"><a href="nn.html#cb35-31"></a><span class="st">            </span><span class="kw">layer_dense</span>(<span class="dt">units=</span>neurons[<span class="dv">2</span>], <span class="dt">activation=</span><span class="st">&#39;relu&#39;</span>, <span class="dt">name=</span><span class="st">&#39;hidden2&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb35-32"><a href="nn.html#cb35-32"></a><span class="st">            </span><span class="kw">layer_dense</span>(<span class="dt">units=</span>neurons[<span class="dv">3</span>], <span class="dt">activation=</span><span class="st">&#39;relu&#39;</span>, <span class="dt">name=</span><span class="st">&#39;hidden3&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb35-33"><a href="nn.html#cb35-33"></a><span class="st">            </span><span class="kw">layer_dense</span>(<span class="dt">units=</span><span class="dv">1</span>, <span class="dt">activation=</span><span class="st">&#39;linear&#39;</span>, <span class="dt">name=</span><span class="st">&#39;NNetwork1&#39;</span>, </span>
<span id="cb35-34"><a href="nn.html#cb35-34"></a>                    <span class="dt">weights=</span><span class="kw">list</span>(<span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim=</span><span class="kw">c</span>(neurons[<span class="dv">3</span>],<span class="dv">1</span>)), <span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim=</span><span class="kw">c</span>(<span class="dv">1</span>))))</span>
<span id="cb35-35"><a href="nn.html#cb35-35"></a>   <span class="co">#</span></span>
<span id="cb35-36"><a href="nn.html#cb35-36"></a>   NNetwork2 =<span class="st"> </span>Cont2 <span class="op">%&gt;%</span></span>
<span id="cb35-37"><a href="nn.html#cb35-37"></a><span class="st">            </span><span class="kw">layer_dense</span>(<span class="dt">units=</span>neurons[<span class="dv">1</span>], <span class="dt">activation=</span><span class="st">&#39;relu&#39;</span>, <span class="dt">name=</span><span class="st">&#39;hidden4&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb35-38"><a href="nn.html#cb35-38"></a><span class="st">            </span><span class="kw">layer_dense</span>(<span class="dt">units=</span>neurons[<span class="dv">2</span>], <span class="dt">activation=</span><span class="st">&#39;relu&#39;</span>, <span class="dt">name=</span><span class="st">&#39;hidden5&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb35-39"><a href="nn.html#cb35-39"></a><span class="st">            </span><span class="kw">layer_dense</span>(<span class="dt">units=</span>neurons[<span class="dv">3</span>], <span class="dt">activation=</span><span class="st">&#39;relu&#39;</span>, <span class="dt">name=</span><span class="st">&#39;hidden6&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb35-40"><a href="nn.html#cb35-40"></a><span class="st">            </span><span class="kw">layer_dense</span>(<span class="dt">units=</span><span class="dv">1</span>, <span class="dt">activation=</span><span class="st">&#39;linear&#39;</span>, <span class="dt">name=</span><span class="st">&#39;NNetwork2&#39;</span>, </span>
<span id="cb35-41"><a href="nn.html#cb35-41"></a>                    <span class="dt">weights=</span><span class="kw">list</span>(<span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim=</span><span class="kw">c</span>(neurons[<span class="dv">3</span>],<span class="dv">1</span>)), <span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim=</span><span class="kw">c</span>(<span class="dv">1</span>))))</span>
<span id="cb35-42"><a href="nn.html#cb35-42"></a></span>
<span id="cb35-43"><a href="nn.html#cb35-43"></a>   <span class="co">#</span></span>
<span id="cb35-44"><a href="nn.html#cb35-44"></a>   NNoutput =<span class="st"> </span><span class="kw">list</span>(NNetwork1, NNetwork2, LogExposure) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">layer_add</span>(<span class="dt">name=</span><span class="st">&#39;Add&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb35-45"><a href="nn.html#cb35-45"></a><span class="st">                 </span><span class="kw">layer_dense</span>(<span class="dt">units=</span><span class="dv">1</span>, <span class="dt">activation=</span>k_exp, <span class="dt">name =</span> <span class="st">&#39;NNoutput&#39;</span>, <span class="dt">trainable=</span><span class="ot">FALSE</span>,</span>
<span id="cb35-46"><a href="nn.html#cb35-46"></a>                       <span class="dt">weights=</span><span class="kw">list</span>(<span class="kw">array</span>(<span class="kw">c</span>(<span class="dv">1</span>), <span class="dt">dim=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)), <span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim=</span><span class="kw">c</span>(<span class="dv">1</span>))))</span>
<span id="cb35-47"><a href="nn.html#cb35-47"></a></span>
<span id="cb35-48"><a href="nn.html#cb35-48"></a>   model &lt;-<span class="st"> </span><span class="kw">keras_model</span>(<span class="dt">inputs =</span> x.input, <span class="dt">outputs =</span> <span class="kw">c</span>(NNoutput))</span>
<span id="cb35-49"><a href="nn.html#cb35-49"></a>   model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">compile</span>(<span class="dt">optimizer =</span> <span class="kw">optimizer_nadam</span>(), <span class="dt">loss =</span> <span class="st">&#39;poisson&#39;</span>)        </span>
<span id="cb35-50"><a href="nn.html#cb35-50"></a>   model</span>
<span id="cb35-51"><a href="nn.html#cb35-51"></a>   }</span>
<span id="cb35-52"><a href="nn.html#cb35-52"></a></span>
<span id="cb35-53"><a href="nn.html#cb35-53"></a>model &lt;-<span class="st"> </span><span class="kw">model.2IA</span>(BrLabel)</span>
<span id="cb35-54"><a href="nn.html#cb35-54"></a><span class="kw">summary</span>(model)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="nn.html#cb36-1"></a>early_stop &lt;-<span class="st"> </span><span class="kw">callback_early_stopping</span>(<span class="dt">monitor =</span> <span class="st">&quot;val_loss&quot;</span>, <span class="dt">patience =</span><span class="dv">10</span>)</span>
<span id="cb36-2"><a href="nn.html#cb36-2"></a><span class="co"># print_dot_callback &lt;- callback_lambda(</span></span>
<span id="cb36-3"><a href="nn.html#cb36-3"></a><span class="co">#   on_epoch_end = function(epoch, logs) {</span></span>
<span id="cb36-4"><a href="nn.html#cb36-4"></a><span class="co">#     if (epoch %% 50 == 0) cat(&quot;\n&quot;)</span></span>
<span id="cb36-5"><a href="nn.html#cb36-5"></a><span class="co">#     cat(&quot;.&quot;)</span></span>
<span id="cb36-6"><a href="nn.html#cb36-6"></a><span class="co">#   }</span></span>
<span id="cb36-7"><a href="nn.html#cb36-7"></a><span class="co"># )  </span></span>
<span id="cb36-8"><a href="nn.html#cb36-8"></a><span class="co"># may take a couple of minutes if epochs is more than 100</span></span>
<span id="cb36-9"><a href="nn.html#cb36-9"></a>{t1 &lt;-<span class="st"> </span><span class="kw">proc.time</span>()</span>
<span id="cb36-10"><a href="nn.html#cb36-10"></a>     fit &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fit</span>(train.x, <span class="kw">as.matrix</span>(dat2_train<span class="op">$</span>ClaimNb), </span>
<span id="cb36-11"><a href="nn.html#cb36-11"></a>                          <span class="dt">epochs=</span><span class="dv">500</span>, <span class="dt">batch_size=</span><span class="dv">10000</span>, <span class="dt">verbose=</span><span class="dv">1</span>,</span>
<span id="cb36-12"><a href="nn.html#cb36-12"></a>                                       <span class="dt">validation_data=</span><span class="kw">list</span>(valid.x,dat2_valid<span class="op">$</span>ClaimNb),</span>
<span id="cb36-13"><a href="nn.html#cb36-13"></a>                          <span class="dt">callback=</span><span class="kw">list</span>(early_stop))</span>
<span id="cb36-14"><a href="nn.html#cb36-14"></a>(<span class="kw">proc.time</span>()<span class="op">-</span>t1)}</span>
<span id="cb36-15"><a href="nn.html#cb36-15"></a></span>
<span id="cb36-16"><a href="nn.html#cb36-16"></a><span class="kw">matplot</span>(<span class="kw">cbind</span>(fit<span class="op">$</span>metrics<span class="op">$</span>loss,fit<span class="op">$</span>metrics<span class="op">$</span>val_loss), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb36-17"><a href="nn.html#cb36-17"></a></span>
<span id="cb36-18"><a href="nn.html#cb36-18"></a>dat2_test<span class="op">$</span>fitGAMPlus &lt;-<span class="st"> </span><span class="kw">as.vector</span>(model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">predict</span>(test.x))</span>
<span id="cb36-19"><a href="nn.html#cb36-19"></a><span class="kw">Poisson.Deviance</span>(dat2_test<span class="op">$</span>fitGAMPlus, dat2_test<span class="op">$</span>ClaimNb)</span>
<span id="cb36-20"><a href="nn.html#cb36-20"></a><span class="kw">keras_poisson_dev</span>(dat2_test<span class="op">$</span>fitGAMPlus, dat2_test<span class="op">$</span>ClaimNb)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="french.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="boosting.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": "github"
},
"fontsettings": {
"theme": "sepia",
"family": "serif",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
